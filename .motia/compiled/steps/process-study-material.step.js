import "dotenv/config";
const config = {
  name: "ProcessStudyMaterial",
  type: "event",
  subscribes: ["study.submit"],
  emits: ["study.completed"],
  flows: ["student-workflow"]
};
const handler = async (event, { emit, logger }) => {
  try {
    const text = event?.text ?? event?.data?.text ?? event?.data?.data?.text;
    if (!text) {
      logger.error("\u274C Event payload missing text", { event });
      throw new Error("No text provided in event");
    }
    logger.info("\u{1F4DA} Processing lecture with AI...", {
      textLength: text.length
    });
    const GEMINI_API_KEY = process.env.GEMINI_API_KEY;
    if (!GEMINI_API_KEY) {
      throw new Error("Gemini API key not configured");
    }
    const prompt = `
You are a study assistant.

Generate:
1. SUMMARY (2\u20133 sentences)
2. KEY POINTS (3\u20135 bullets)
3. STUDY QUESTIONS (3 questions)

Lecture:
${text}

Format clearly with headers.
`;
    logger.info("\u{1F916} Calling Gemini AI...");
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }]
        })
      }
    );
    const aiResponse = await response.json();
    const result = aiResponse?.candidates?.[0]?.content?.parts?.[0]?.text;
    if (!result) {
      throw new Error("Gemini returned empty response");
    }
    logger.info("\u2705 Study material generated");
    await emit({
      topic: "study.completed",
      data: {
        studyMaterial: result,
        originalText: text
      }
    });
  } catch (err) {
    logger.error("\u274C Processing failed", { message: err.message });
    await emit({
      topic: "study.completed",
      data: { error: err.message }
    });
  }
};
export {
  config,
  handler
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vc3RlcHMvcHJvY2Vzcy1zdHVkeS1tYXRlcmlhbC5zdGVwLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgXCJkb3RlbnYvY29uZmlnXCI7XHJcblxyXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xyXG4gICAgbmFtZTogXCJQcm9jZXNzU3R1ZHlNYXRlcmlhbFwiLFxyXG4gICAgdHlwZTogXCJldmVudFwiLFxyXG4gICAgc3Vic2NyaWJlczogW1wic3R1ZHkuc3VibWl0XCJdLFxyXG4gICAgZW1pdHM6IFtcInN0dWR5LmNvbXBsZXRlZFwiXSxcclxuICAgIGZsb3dzOiBbXCJzdHVkZW50LXdvcmtmbG93XCJdLFxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGhhbmRsZXIgPSBhc3luYyAoZXZlbnQ6IGFueSwgeyBlbWl0LCBsb2dnZXIgfTogYW55KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIFx1MjcwNSBVTklWRVJTQUwgTW90aWEtc2FmZSBleHRyYWN0aW9uXHJcbiAgICAgICAgY29uc3QgdGV4dCA9XHJcbiAgICAgICAgICAgIGV2ZW50Py50ZXh0ID8/XHJcbiAgICAgICAgICAgIGV2ZW50Py5kYXRhPy50ZXh0ID8/XHJcbiAgICAgICAgICAgIGV2ZW50Py5kYXRhPy5kYXRhPy50ZXh0O1xyXG5cclxuICAgICAgICBpZiAoIXRleHQpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFwiXHUyNzRDIEV2ZW50IHBheWxvYWQgbWlzc2luZyB0ZXh0XCIsIHsgZXZlbnQgfSk7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHRleHQgcHJvdmlkZWQgaW4gZXZlbnRcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsb2dnZXIuaW5mbyhcIlx1RDgzRFx1RENEQSBQcm9jZXNzaW5nIGxlY3R1cmUgd2l0aCBBSS4uLlwiLCB7XHJcbiAgICAgICAgICAgIHRleHRMZW5ndGg6IHRleHQubGVuZ3RoLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBHRU1JTklfQVBJX0tFWSA9IHByb2Nlc3MuZW52LkdFTUlOSV9BUElfS0VZO1xyXG4gICAgICAgIGlmICghR0VNSU5JX0FQSV9LRVkpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiR2VtaW5pIEFQSSBrZXkgbm90IGNvbmZpZ3VyZWRcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBwcm9tcHQgPSBgXHJcbllvdSBhcmUgYSBzdHVkeSBhc3Npc3RhbnQuXHJcblxyXG5HZW5lcmF0ZTpcclxuMS4gU1VNTUFSWSAoMlx1MjAxMzMgc2VudGVuY2VzKVxyXG4yLiBLRVkgUE9JTlRTICgzXHUyMDEzNSBidWxsZXRzKVxyXG4zLiBTVFVEWSBRVUVTVElPTlMgKDMgcXVlc3Rpb25zKVxyXG5cclxuTGVjdHVyZTpcclxuJHt0ZXh0fVxyXG5cclxuRm9ybWF0IGNsZWFybHkgd2l0aCBoZWFkZXJzLlxyXG5gO1xyXG5cclxuICAgICAgICBsb2dnZXIuaW5mbyhcIlx1RDgzRVx1REQxNiBDYWxsaW5nIEdlbWluaSBBSS4uLlwiKTtcclxuXHJcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcclxuICAgICAgICAgICAgYGh0dHBzOi8vZ2VuZXJhdGl2ZWxhbmd1YWdlLmdvb2dsZWFwaXMuY29tL3YxYmV0YS9tb2RlbHMvZ2VtaW5pLTIuNS1mbGFzaDpnZW5lcmF0ZUNvbnRlbnQ/a2V5PSR7R0VNSU5JX0FQSV9LRVl9YCxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSxcclxuICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50czogW3sgcGFydHM6IFt7IHRleHQ6IHByb21wdCB9XSB9XSxcclxuICAgICAgICAgICAgICAgIH0pLFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgY29uc3QgYWlSZXNwb25zZSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICBjb25zdCByZXN1bHQgPVxyXG4gICAgICAgICAgICBhaVJlc3BvbnNlPy5jYW5kaWRhdGVzPy5bMF0/LmNvbnRlbnQ/LnBhcnRzPy5bMF0/LnRleHQ7XHJcblxyXG4gICAgICAgIGlmICghcmVzdWx0KSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkdlbWluaSByZXR1cm5lZCBlbXB0eSByZXNwb25zZVwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxvZ2dlci5pbmZvKFwiXHUyNzA1IFN0dWR5IG1hdGVyaWFsIGdlbmVyYXRlZFwiKTtcclxuXHJcbiAgICAgICAgYXdhaXQgZW1pdCh7XHJcbiAgICAgICAgICAgIHRvcGljOiBcInN0dWR5LmNvbXBsZXRlZFwiLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBzdHVkeU1hdGVyaWFsOiByZXN1bHQsXHJcbiAgICAgICAgICAgICAgICBvcmlnaW5hbFRleHQ6IHRleHQsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnI6IGFueSkge1xyXG4gICAgICAgIGxvZ2dlci5lcnJvcihcIlx1Mjc0QyBQcm9jZXNzaW5nIGZhaWxlZFwiLCB7IG1lc3NhZ2U6IGVyci5tZXNzYWdlIH0pO1xyXG5cclxuICAgICAgICBhd2FpdCBlbWl0KHtcclxuICAgICAgICAgICAgdG9waWM6IFwic3R1ZHkuY29tcGxldGVkXCIsXHJcbiAgICAgICAgICAgIGRhdGE6IHsgZXJyb3I6IGVyci5tZXNzYWdlIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcbiJdLAogICJtYXBwaW5ncyI6ICJBQUFBLE9BQU87QUFFQSxNQUFNLFNBQVM7QUFBQSxFQUNsQixNQUFNO0FBQUEsRUFDTixNQUFNO0FBQUEsRUFDTixZQUFZLENBQUMsY0FBYztBQUFBLEVBQzNCLE9BQU8sQ0FBQyxpQkFBaUI7QUFBQSxFQUN6QixPQUFPLENBQUMsa0JBQWtCO0FBQzlCO0FBRU8sTUFBTSxVQUFVLE9BQU8sT0FBWSxFQUFFLE1BQU0sT0FBTyxNQUFXO0FBQ2hFLE1BQUk7QUFFQSxVQUFNLE9BQ0YsT0FBTyxRQUNQLE9BQU8sTUFBTSxRQUNiLE9BQU8sTUFBTSxNQUFNO0FBRXZCLFFBQUksQ0FBQyxNQUFNO0FBQ1AsYUFBTyxNQUFNLHFDQUFnQyxFQUFFLE1BQU0sQ0FBQztBQUN0RCxZQUFNLElBQUksTUFBTSwyQkFBMkI7QUFBQSxJQUMvQztBQUVBLFdBQU8sS0FBSywyQ0FBb0M7QUFBQSxNQUM1QyxZQUFZLEtBQUs7QUFBQSxJQUNyQixDQUFDO0FBRUQsVUFBTSxpQkFBaUIsUUFBUSxJQUFJO0FBQ25DLFFBQUksQ0FBQyxnQkFBZ0I7QUFDakIsWUFBTSxJQUFJLE1BQU0sK0JBQStCO0FBQUEsSUFDbkQ7QUFFQSxVQUFNLFNBQVM7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFTckIsSUFBSTtBQUFBO0FBQUE7QUFBQTtBQUtFLFdBQU8sS0FBSyxnQ0FBeUI7QUFFckMsVUFBTSxXQUFXLE1BQU07QUFBQSxNQUNuQixnR0FBZ0csY0FBYztBQUFBLE1BQzlHO0FBQUEsUUFDSSxRQUFRO0FBQUEsUUFDUixTQUFTLEVBQUUsZ0JBQWdCLG1CQUFtQjtBQUFBLFFBQzlDLE1BQU0sS0FBSyxVQUFVO0FBQUEsVUFDakIsVUFBVSxDQUFDLEVBQUUsT0FBTyxDQUFDLEVBQUUsTUFBTSxPQUFPLENBQUMsRUFBRSxDQUFDO0FBQUEsUUFDNUMsQ0FBQztBQUFBLE1BQ0w7QUFBQSxJQUNKO0FBRUEsVUFBTSxhQUFhLE1BQU0sU0FBUyxLQUFLO0FBQ3ZDLFVBQU0sU0FDRixZQUFZLGFBQWEsQ0FBQyxHQUFHLFNBQVMsUUFBUSxDQUFDLEdBQUc7QUFFdEQsUUFBSSxDQUFDLFFBQVE7QUFDVCxZQUFNLElBQUksTUFBTSxnQ0FBZ0M7QUFBQSxJQUNwRDtBQUVBLFdBQU8sS0FBSyxpQ0FBNEI7QUFFeEMsVUFBTSxLQUFLO0FBQUEsTUFDUCxPQUFPO0FBQUEsTUFDUCxNQUFNO0FBQUEsUUFDRixlQUFlO0FBQUEsUUFDZixjQUFjO0FBQUEsTUFDbEI7QUFBQSxJQUNKLENBQUM7QUFBQSxFQUNMLFNBQVMsS0FBVTtBQUNmLFdBQU8sTUFBTSw0QkFBdUIsRUFBRSxTQUFTLElBQUksUUFBUSxDQUFDO0FBRTVELFVBQU0sS0FBSztBQUFBLE1BQ1AsT0FBTztBQUFBLE1BQ1AsTUFBTSxFQUFFLE9BQU8sSUFBSSxRQUFRO0FBQUEsSUFDL0IsQ0FBQztBQUFBLEVBQ0w7QUFDSjsiLAogICJuYW1lcyI6IFtdCn0K
